## ЗАПУСК

для запуска программы нужно выполнить команду

> docker compose up -d --build

данная команда поднимет два докер контейнера с образом базы данных postgres и приложения на flask, предоставляющего api для связи с базой данных.

база данных будет доступна по адресу:

> localhost:5432

Логин и пароль указаны в файле .env

сервис flask будет доступен по адресу 

> localhost:5000

При первичном запуске в базе данных будут созданы сущности, описанные в файле initial.sql

Данный файл содержит команды по созданию четырёх sql таблиц:

> clients, restaurants, tables, reservations

Функции для проверки валидности новых бронирований столиков:

> reservations_check

И триггера, запускающего проверку бронирования перед операциями update и insert:

> reservations_check


## Заполнение таблиц тестовыми данными

Скрипт для заполнения таблиц тестовыми данными находится в файле 

> app/src/insert_test_data.py

Словари с данными о клиентах и ресторанах находятся в файле 

> app/src/entries.py

При запущенном docker compose скрипт заполнения таблиц можно вызвать командой:

> docker exec -it app python -m insert_test_data 20

где цифра 20 - это переменная, количество записей о бронировании, которые необходимо добавить.

## Конечные точки (API)

api доступны по адресу 

> localhost:5000

### GET /reservation

Возвращает все бронирования, сгруппированные по ресторанам, столикам и датам. Возможна фильтрация по дате и по ресторану:

```
param restaurant_id - id ресторана, для которого нужно получить бронирования

param date - дата, на которую нужно получить бронирования
```

Пример запроса для ресторана с id=1 на дату 2023-04-13

> /reservation?date=2023-04-13&restaurant_id=1

Ответ:

restaurant_id:
    internal_id (внутренний номер столика):
        date (дата бронирования): [
            массив с бронированиями
        ]

```
{
    "2": {
        "1": {
            "2023-04-13": {
                "clients_name": "Пётр",
                "clients_phone": "+7(123)1231231",
                "end_time": "11:13:04",
                "start_time": "10:13:04"
            }
        },
        "7": {
            "2023-04-13": {
                "clients_name": "Сергей",
                "clients_phone": "+7(123)5151515",
                "end_time": "15:36:28",
                "start_time": "14:36:28"
            }
        }
    }
}
```

### POST /reservations

Добавляет в базу данных бронирование конкретного столика для клиента на определённое время

body:

```
{
    "date": "2023-09-21",
    "start_time": "14:00", 
    "end_time": "15:00",
    "client_id": 1,
    "table_id": 7
}
```

В случае успешного бронирования с этими вводными придёт код 201 и ответ:

```
"Столик 7 забронирован с 14:00:00 до 15:00:00 2023-09-21 для клиента Пётр!"
```

В случае, если столик уже занят на это время, эндпоинт вернёт ошибку
```
"This time is already reserved by another client!"
```

Если время бронирования начинается или заканчивается в нерабочее время ресторана:

"Reservation start time cannot be earlier than restaurant opening hours!"
"Reservation end time cannot be later than restaurant opening hours!"

### DELETE /reservations/<int:reservation_id>

Удаляет бронирование с указанным id

### PUT /reservations/<int:reservation_id>

Изменяет детали бронирования для указанного id

body
```
{
    "date": "2023-09-21",
    "start_time": "14:00", 
    "end_time": "15:00",
    "client_id": 1,
    "table_id": 7
}
```
